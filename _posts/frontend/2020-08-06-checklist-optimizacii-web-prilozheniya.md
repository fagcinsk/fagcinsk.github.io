---
layout: post
categories: frontend
title: Чеклист оптимизации веб-приложения
description: Пополняемый список ключевых моментов и методов оптимизации сайтов и веб-приложений. Методы направлены на ускорение загрузки страниц и уменьшение времени отклика, что полжительно сказывается на пользовательском опыте.
image: photos/2020-08-06-checklist-optimizacii-web-prilozheniya.jpg
---

Оставлю здесь список методов, способов повышения производительности веб-сервисов, веб-приложений и сайтов.
Будет полезно мне при выкатывании очередного проекта в продакшен,
а также всем заинтересованным в отзывчивых веб-приложениях и веб-интерфейсах.

![Тайминги загрузки страницы](/photos/timings_simple.png)

## Серверная часть

На серверной стороне и на бэкэнде в целом улучшается параметр [Time To First Byte (TTFB)](https://developer.mozilla.org/ru/docs/%D0%A1%D0%BB%D0%BE%D0%B2%D0%B0%D1%80%D1%8C/time_to_first_byte).
Этот параметр показывает время от начала запроса до получения первого байта данных от сервера.

На начальном этапе время тратится на:

- задержку сети;
- получение IP от DNS сервера;
- установку соединения.

TTFB складывается из времени на:

- передачу пакета данных запроса;
- обработку запроса веб-приложением;
- генерацию ответа (добавление заголовков, сжатие).

Уменьшить это время можно несколькими способами:

- обеспечить высокую пропускную способность сети;
- предусмотреть балансировку нагрузки;
- использовать CDN доставки контента от ближайшего сервера или сервера с меньшим пингом;
- оптимизировать веб-сервер для обработки большого количества запросов:
  - облегчить правила фаервола;
  - уменьшить количество прокси;
  - настроить буферы;
  - настроить кеширование статики.
- настроить сжатие ([оптимально brotli](https://habr.com/ru/company/ruvds/blog/499278/) со степенью компрессии около 5, значение выше не даёт значительного уменьшения);
- уменьшить количество передаваемых заголовков в ответе;
- использование протокола http2 для обработки запросов в одном соединении;
- улучшить производительность самого веб-приложения.

## Оптимизация веб-приложения

Веб-приложение обычно состоит из бэкэнда и фронтенда.

### Бэкэнд

Оптимизация бэкэнда (так же влияет на показатель TTFB) сводится к следующему:

  - стараться использовать статику где это возможно;
  - настроить кеширование и буферизацию запросов к БД;
  - настроить кеширование страниц;
  - настроить кеширование скриптов прилжения (opcache, apc(u) cache, ...);
  - оптимизировать запросы к БД;
  - минимизировать объём передаваемых данных от api.

### Фронтенд

![Тайминги загрузки страницы сайта (источник: developer.mozilla.org)](/photos/navigation_resource_timings.png)

На фронтенде показателей больше:

- [First Contentful Paint (FCP)](https://developer.mozilla.org/ru/docs/%D0%A1%D0%BB%D0%BE%D0%B2%D0%B0%D1%80%D1%8C/First_contentful_paint) &mdash; время до первой отрисовки;
- [First Meaningful Paint (FMP)](https://developer.mozilla.org/ru/docs/%D0%A1%D0%BB%D0%BE%D0%B2%D0%B0%D1%80%D1%8C/first_meaningful_paint) &mdash; время до отрисовки основной части контента;
- [First Input Delay (FID)](https://developer.mozilla.org/ru/docs/%D0%A1%D0%BB%D0%BE%D0%B2%D0%B0%D1%80%D1%8C/First_input_delay) &mdash; время отклика на событие, генерированное пользователем;
- [Total Blocking Time (TBT)](https://web.dev/tbt/) &mdash; суммарное время задач длительностью более 50мс;
- [Time To Interactive (TTI)](https://developer.mozilla.org/ru/docs/%D0%A1%D0%BB%D0%BE%D0%B2%D0%B0%D1%80%D1%8C/Time_to_interactive) &mdash; время до начала интерактивности элементов страницы.

Оптимизируется всё это на нескольких уровнях.

Разметка HTML:

- уменьшение вложенности DOM дерева;
- минификация, использование табов для отступов.

Стили CSS:

- вынесение критичных стилей в head > style;
- разделение стилей на куски и их дозагрузка после первого экрана;
- упрощение селекторов CSS (по методологии БЭМ);
- минификация.

Скрипты JavaScript:

- перенос, либо отложенная (async, defer) загрузка скриптов JavaScript;
- requestAnimationFrame для анимаций;
- requestIdleFrame для длительных задач;
- WebWorkers для сложных длительных задач;
- ServiceWorkers для обеспечения кеширования запросов;
- ленивая загрузка данных (Infinite Scrolling);
- минификация.

Изображения:

- ленивая загрузка изображений;
- правильный выбор формата изображений (jpeg &mdash; фото, png &mdash; чертежи или логотипы или постеры);
- [оптимизация изображений для веб](/blog/frontend/imagemagick-convert-optimization-snippets):
  - сжатие изображений по размеру в пикселях;
  - использование векторной графики или CSS3 где это возможно;
  - сжатие изображений по качеству;
  - использование современных способов сжатия (webp).

Шрифты:

- ленивая загрузка веб-шрифтов, в идеале использование [системных - Web safe шрифтов](/blog/frontend/most-recent-variant-of-css-system-font-families);
- уменьшение количества шрифтов;
- использование шрифтов только нужных языков;
- выбор меньшего количества начертаний (font-weight).

Список оптимизируемого будет пополняться, пока это всё, что вспомнил. =)

Оптимизируя приложения следите за временем. ;) Правило 20%/80% работает и здесь:
за 20% времени можно улучшить производительность приложения на 80%, остальное время
чаще всего тратится на долгое ковыряние за десятки милли- и даже микросекунд.
